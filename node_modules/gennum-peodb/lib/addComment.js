//============================================================================//

var print = console.log;

//============================================================================//

module.exports = function(PEODB) {

  var requiredArgs = [
    'user_id',
    'comment_key',
    'data',
  ];

  PEODB.prototype.addComment = function(args, cb) {
    var peodb = this;

    var missingArg = peodb.checkArgs(requiredArgs, args);
    if (missingArg) {
      return cb(Error('missing required argument: ' + missingArg));
    }

    peodb.dbSession(args, function(db, cb) {
      addComment(db, args, cb);
    }, cb);
  }

  function addComment(db, args, cb) {
    db.transaction(function(cb) {
      var qStr =
        'INSERT INTO comments ('
      + '  comment_id, comment_key, user_id, create_time, data'
      + ') VALUES ('
      + '  NULL'
      + ',' + db.escape(args.comment_key)
      + ',' + db.escape(args.user_id)
      + ',UNIX_TIMESTAMP()'
      + ',' + db.escape(args.data)
      + ')'
      ;
      db.queryData(qStr, function(err, data) {
        if (err) {
          return cb(err);
        }
        return cb(null, data.insertId);
      });
    },
    cb);
  }
}

//============================================================================//
