//============================================================================//

var print = console.log;

var async = require('async');

//============================================================================//
//
//  testflags = [
//    { name: '...', value: '...', state: '...' },
//  ]
//
//============================================================================//

module.exports = function(PEODB) {

  var requiredArgs = [
    'db',
    'tp_rev_id',
    'testflags',
  ];

  //==========================================================================//

  PEODB.prototype.addTPrevFlags = function(args, cb) {
    var peodb = this;

    var missingArg = peodb.checkArgs(requiredArgs, args);
    if (missingArg) {
      return cb(Error('missing  argument: ' + missingArg));
    }

    var db = args.db;

    async.forEachSeries(args.testflags,
      function(flag, cb) {
        addTestflag(db, args.tp_rev_id, flag, cb);
      },
    cb);
  }

  function addTestflag(db, tp_rev_id, flag, cb) {
    var qStr =
      'INSERT INTO test_flags'
    + ' (test_flag_id'
    + ', tp_rev_id'
    + ', flag_name'
    + ', flag_value'
    + ', state'
    + ') VALUES'
    + ' (NULL' // test_flag_id
    + ',' + db.escape(tp_rev_id)
    + ',' + db.escape(flag.name)
    + ',' + db.escape(flag.value)
    + ',' + db.escape(flag.state)
    + ')'
    ;
    db.queryData(qStr, cb);
  }
}

//============================================================================//
