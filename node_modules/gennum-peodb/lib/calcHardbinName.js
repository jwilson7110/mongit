//============================================================================//

var print = console.log;

//============================================================================//

module.exports = function(PEODB) {

  var requiredArgs = [
    'hbin_num',
    'good_bin',
  ];

  PEODB.prototype.calcHardbinName = function(args) {
    var peodb = this;

    var missingArg = peodb.checkArgs(requiredArgs, args);
    if (missingArg) {
      return cb(Error('missing required argument: ' + missingArg));
    }

    var binNum     = args.hbin_num;
    var isPass     = !!args.good_bin;
    var oldName    = args.name || '';
    var partNumber = args.partNumber || '';

    var num = binNum.toString();
    while (num.length < 2) { num = '0' + num;  }

    partNum = partNumber || 'UNKNOWN';

    if (oldName) {
      if (!oldName.match(/(PASS|FAIL)\d{2}_/)) {
        oldName = '_' + oldName;
      }
      else {
        var matches = oldName.match(/(PASS|FAIL)\d{2}_[^_]*(_.*)$/);
        if (!matches) {
          oldName = '';
        } else {
          oldName = matches[2];
        }
      }
      oldName = oldName.replace(/\s/g, '_');
    }

    var name = (isPass ? 'PASS' : 'FAIL') + num + '_' + partNum + oldName;

    return name;   
  }
}

//============================================================================//
