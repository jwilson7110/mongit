//============================================================================//

var print = console.log;

var async = require('async');

//============================================================================//

module.exports = function(PEODB) {

  //  roleChanges = {
  //    inserted: [
  //      { object_id: #, user_id: #, role_type_id: # },
  //      ...
  //    ],
  //    deleted: [
  //      { object_id: #, user_id: #, role_type_id: # },
  //      ...
  //    ],
  //  }

  PEODB.prototype.emailRoles = function(roleChanges, cb) { // FIXME - not done

  }
}

//============================================================================//

function collectObjects(roleChanges) {
  var objects = {};
  for (var i = 0; i < inserted.length; i++) {
    var change = inserted[i];
    if (change.object_id === object_id) {
      recipients[change.user_id] = true;
    }
  }
  for (var i = 0; i < deleted.length; i++) {
    var change = deleted[i];
    if (change.object_id === object_id) {
      recipients[change.user_id] = true;
    }
  }

}

//============================================================================//

function getObjectRecipients(db, roleChanges, object_id, cb) {
  var recipients = {};
  var inserted = roleChanges.inserted;
  var deleted  = roleChanges.deleted;

  // first, collect directly from roleChanges
  for (var i = 0; i < inserted.length; i++) {
    var change = inserted[i];
    if (change.object_id === object_id) {
      recipients[change.user_id] = true;
    }
  }
  for (var i = 0; i < deleted.length; i++) {
    var change = deleted[i];
    if (change.object_id === object_id) {
      recipients[change.user_id] = true;
    }
  }

  var qStr =
    'SELECT user_id'
  + ' FROM object_roles'
  + ' WHERE object_id = ' + db.escape(object_id)
  ;
  db.queryData(qStr, function(err, data) {
    if (err) {
      return cb(err);
    }
  });
}

//============================================================================//
