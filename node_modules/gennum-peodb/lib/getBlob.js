//============================================================================//

var print = console.log;

//============================================================================//

module.exports = function(PEODB) {

  PEODB.prototype.getBlob = function(args, cb) {
    var peodb = this;

    if (!(args instanceof Object)) {
      args = { blob_id: args };
    }

    getBlob(peodb.sharedDB, args, cb);
  }

  function getBlob(db, args, cb) { // FIXME
    var qStr =
      'SELECT'
    + '   data, data_encoding, length'
    + ' , object_id, user_id, create_time, version'
    + ' , name, orig_name, mimetype, public_access'
    + ' FROM  blobs'
    + ' WHERE blob_id = ' + db.escape(args.blob_id)
    ;
    db.queryData(qStr, function(err, data) {
      if (err) {
        return cb(err);
      }
      if (data.rows.length !== 1) {
        return cb(Error('invalid blob_id: ' + args.blob_id));
      }
      var blob = data.rows[0].toMap();
      print('getBlob(' + args.blob_id + ') encoding = ' + blob.data_encoding); // FIXME
      if (blob.data_encoding === 'base64') {
        blob.data = new Buffer(blob.data, 'base64');
      }
      return cb(err, blob);
    });
  }
}

//============================================================================//
