//============================================================================//

var print = console.log;

//============================================================================//

var queryBasis =
  'SELECT'
  + '     p.part_id       AS part_id'
  + '   , p.part_number   AS part_number'
  + '   , p.sap_type      AS sap_part_type'
  + '   , p.description   AS description'
  + '   , p.state         AS state'
  + '   , pt.part_type_id AS part_type_id'
  + '   , pt.name         AS part_type_name'
  + '   , pt.abbr         AS part_type_abbr'
  + '   , pt.primary_type AS part_type_primary'
  + ' FROM'
  + '   parts p'
  + '   JOIN part_types pt  ON (pt.part_type_id = p.part_type_id)'
  ;


module.exports = function(PEODB) {

  PEODB.prototype.getParts = function(args, cb) {
    var peodb = this;

    if (typeof(args) === 'function') {
      cb = args;
      args = {};
    }

    getParts(peodb.sharedDB, args, cb);
  }

  function getParts(db, args, cb) {
    var qStr = queryBasis;
    qStr += ' WHERE 1 = 1'

    if (args.state) {
      qStr += ' AND state = ' + db.escape(args.state);
    }

    if (args.part_number)  {
      qStr += ' AND p.part_number = ' + db.escape(args.part_number);
    }
    else if (args.pn_like)  {
      qStr += ' AND p.part_number LIKE ' + db.escape(args.pn_like);
    }

    db.queryData(qStr, function(err, data) {
      return cb(err, data);
    });
  }
}

//============================================================================//
