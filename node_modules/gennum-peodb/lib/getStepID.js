//============================================================================//
//
//  simple utilities for querying the step_id from tp_sets, tps, and tp_revs
//
//============================================================================//

module.exports = function(PEODB) {

  function getStepID(peodb, args, table, field, id, cb) {
    var db = args.db ? args.db : peodb.sharedDB;
    var idStr = db.escape(id);
    var qStr  =
      'SELECT step_id'
    + ' FROM ' + table
    + ' WHERE ' + field + ' = ' + idStr
    ;
    return db.query1Value(qStr, cb);
  }

  //==========================================================================//

  PEODB.prototype.getTPsetStepID = function(args, cb) {
    if (!(args instanceof Object)) {
      args = { tp_set_id: args };
    }
    if (typeof(args.tp_set_id) === 'undefined') {
      return cb(Error('missing required argument: tp_set_id'));
    }
    return getStepID(this, args, 'tp_sets', 'tp_set_id', args.tp_set_id, cb);
  }

  PEODB.prototype.getTPStepID = function(args, cb) {
    if (!(args instanceof Object)) {
      args = { tp_id: args };
    }
    if (typeof(args.tp_id) === 'undefined') {
      return cb(Error('missing required argument: tp_id'));
    }
    return getStepID(this, args, 'tps', 'tp_id', args.tp_id, cb);
  }

  PEODB.prototype.getTPrevStepID = function(args, cb) {
    if (!(args instanceof Object)) {
      args = { tp_rev_id: args };
    }
    if (typeof(args.tp_rev_id) === 'undefined') {
      return cb(Error('missing required argument: tp_rev_id'));
    }
    return getStepID(this, args, 'tp_revs', 'tp_rev_id', args.tp_rev_id, cb);
  }
}

//============================================================================//
