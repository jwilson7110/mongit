//============================================================================//

var print = console.log;

//============================================================================//

var queryBasis =
  'SELECT'
  + '     s.step_id        as step_id'
  + '   , s.state          as state'
  + '   , st.step_type_id  as step_type_id'
  + '   , st.step_name     as step_type_name'
  + '   , st.step_abbr     as step_type_abbr'
  + ' FROM'
  + '   steps           s'
  + '   JOIN step_types st ON (st.step_type_id = s.step_type_id)'
  ;

module.exports = function(PEODB) {

  PEODB.prototype.getSteps = function(args, cb) {
    var peodb = this;

    if (typeof(args) === 'function') {
      cb = args;
      args = {};
    }

    getSteps(peodb.sharedDB, args, cb);
  }

  function getSteps(db, args, cb) {
    var qStr = queryBasis;
    qStr += ' WHERE 1 = 1'
    if (args.state) {
      qStr += ' AND s.state = ' + db.escape(args.state);
    }
    if (args.step_type_id)  {
      qStr += ' AND s.step_type_id = ' + db.escape(args.step_type_id);
    }
    if (args.step_type_abbr)  {
      qStr += ' AND st.step_abbr = ' + db.escape(args.step_type_abbr);
    }
    db.queryData(qStr, cb);
  }
}

//============================================================================//
