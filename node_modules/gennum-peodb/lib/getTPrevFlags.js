//============================================================================//

var print = console.log;

//============================================================================//

var queryBasis =
  'SELECT'
  + '     tr.tp_rev_id'
  + '   , tf.test_flag_id'
  + '   , tf.flag_name      AS name'
  + '   , tf.flag_value     AS value'
  + '   , tf.state'
  + ' FROM'
  + '   tp_revs          tr'
  + '   JOIN test_flags  tf  ON (tf.tp_rev_id = tr.tp_rev_id)'
  ;

//============================================================================//

module.exports = function(PEODB) {

  var requiredArgs = [
    'tp_rev_id',
  ];

  PEODB.prototype.getTPrevFlags = function(args, cb) {
    var peodb = this;

    if (!(args instanceof Object)) {
      args = { tp_rev_id: args };
    }

    var missingArg = peodb.checkArgs(requiredArgs, args);
    if (missingArg) {
      return cb(Error('missing required argument: ' + missingArg));
    }

    var db = peodb.sharedDB;

    var qStr =
      queryBasis + ' WHERE tr.tp_rev_id = ' + db.escape(args.tp_rev_id);
    db.queryData(qStr, cb);
  }

  //==========================================================================//
}

//============================================================================//

