################################################################################
#
#  Hard and Soft bins
#

CREATE TABLE `hardbins` (
  `hardbin_id`          INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `tp_rev_id`           INT UNSIGNED NOT NULL
, `hbin_num`            INT UNSIGNED NOT NULL
, `step_output_id`      INT UNSIGNED
, `name`                VARCHAR(255)
, `good_bin`            BOOLEAN      NOT NULL
, `hold_min_percent`    FLOAT
, `hold_max_percent`    FLOAT
, UNIQUE  KEY (`tp_rev_id`, `hbin_num`)
, FOREIGN KEY (`tp_rev_id`)      REFERENCES `tp_revs`      (`tp_rev_id`)
, FOREIGN KEY (`step_output_id`) REFERENCES `step_outputs` (`step_output_id`)
);


CREATE TABLE `softbins` (
  `softbin_id`          INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `hardbin_id`          INT UNSIGNED NOT NULL
, `tp_rev_id`           INT UNSIGNED NOT NULL -- to ensure sbin_num uniqueness
, `sbin_num`            INT UNSIGNED NOT NULL
, `name`                VARCHAR(255) NOT NULL
, `good_bin`            BOOLEAN      NOT NULL
, UNIQUE  KEY (`tp_rev_id`, `sbin_num`)
, FOREIGN KEY (`tp_rev_id`)      REFERENCES `tp_revs`      (`tp_rev_id`)
, FOREIGN KEY (`hardbin_id`) REFERENCES `hardbins` (`hardbin_id`)
);


################################################################################

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("hardbins", NULL,               "hard bins")
, ("hardbins", "hardbin_id",       "primary key")
, ("hardbins", "tp_rev_id",        "associated test program revision")
, ("hardbins", "hbin_num",         "hardbin number")
, ("hardbins", "step_output_id",   "associate the hard bin to a part")
, ("hardbins", "name",             "bin name - from the test program")
, ("hardbins", "good_bin",         "is this a good bin?")
, ("hardbins", "hold_min_percent", "if the yield is less or equal to min, hold the parts")
, ("hardbins", "hold_max_percent", "if the yield is greater or equal to max, hold the parts")
;

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("softbins", NULL,               "soft bins")
, ("softbins", "softbin_id",       "primary key")
, ("softbins", "hardbin_id",       "foreign key into hardbins")
, ("softbins", "sbin_num",         "softbin number")
, ("softbins", "name",             "bin name - from the test program")
, ("softbins", "good_bin",         "is this a good bin?")
;


################################################################################
