################################################################################

CREATE TABLE `blob_types` (
  `blob_type_id`        INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `name`                VARCHAR(255) NOT NULL
, `abbr`                VARCHAR(8)   NOT NULL
, UNIQUE KEY (`name`)
, UNIQUE KEY (`abbr`)
);

################################################################################

CREATE TABLE `blobs` (
  `blob_id`             INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `blob_type_id`        INT UNSIGNED NOT NULL
, `object_id`           INT UNSIGNED NOT NULL
, `user_id`             INT SIGNED   NOT NULL
, `create_time`         DOUBLE       NOT NULL -- TIME_T
, `version`             INT UNSIGNED NOT NULL DEFAULT 1
, `active`              BOOLEAN      NOT NULL DEFAULT TRUE
, `name`                VARCHAR(255) NOT NULL
, `orig_name`           VARCHAR(255) NOT NULL
, `data`                LONGBLOB     NOT NULL
, `data_encoding`       VARCHAR(16)  NOT NULL -- ex: 'base64'
, `length`              INT UNSIGNED NOT NULL -- unencoded length
, `mimetype`            VARCHAR(64)
, `etag`                VARCHAR(255)
, `public_access`       BOOLEAN      NOT NULL DEFAULT FALSE
, UNIQUE  KEY (`name`, `version`, `object_id`)
, FOREIGN KEY (`user_id`)      REFERENCES `users`      (`user_id`)
, FOREIGN KEY (`object_id`)    REFERENCES `objects`    (`object_id`)
, FOREIGN KEY (`blob_type_id`) REFERENCES `blob_types` (`blob_type_id`)
);

################################################################################
