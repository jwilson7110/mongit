################################################################################
#
#  Companies
#

CREATE TABLE `companies` (
  `company_id`          INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `parent_company_id`   INT UNSIGNED
, `name`                VARCHAR(255) NOT NULL
, `state`               ENUM('ACTIVE', 'OBSOLETE') NOT NULL
, UNIQUE KEY (`name`)
, FOREIGN KEY (`parent_company_id`) REFERENCES `companies` (`company_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("companies", NULL,       "external companies")
, ("companies", "company_id", "primary key")
, ("companies", "name",       "the company's name")
;


################################################################################
#
#  Contacts  (external company contacts)
#

CREATE TABLE `contacts` (
  `contact_id`          INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `company_id`          INT UNSIGNED NOT NULL
, `name`                VARCHAR(255) NOT NULL
, `phone`               VARCHAR(255)
, `mobile`              VARCHAR(255)
, `email`               VARCHAR(255)
, `fax`                 VARCHAR(255)
, `state`               ENUM('ACTIVE', 'OBSOLETE') NOT NULL
, UNIQUE KEY (`name`)
, FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("contacts", NULL,          "external contacts")
, ("contacts", "contact_id",  "contact name")
, ("contacts", "company_id",  "references the `companies` table")
, ("contacts", "name",        "contact name")
, ("contacts", "phone",       "contact work phone number, ex: '(613) 270-0458 x2763'")
, ("contacts", "mobile",      "contact mobile phone number, ex: '(613) 555-1234'")
, ("contacts", "email",       "contact email address, ex: darodger@semtech.com")
, ("contacts", "fax",         "contact fax machine -- so 1980's")
;


################################################################################
#
#  Liasons
#

CREATE TABLE `company_liaisons` ( -- TIE-TABLE
  `company_id`           INT UNSIGNED NOT NULL
, `user_id`              INT SIGNED   NOT NULL
, PRIMARY KEY (`company_id`, `user_id`)
, FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`)
, FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("company_liaisons", NULL,         "external company liaisons")
, ("company_liaisons", "company_id", "the company")
, ("company_liaisons", "user_id",    "the Gennum employee")
;


################################################################################
#
#  Company Types
#

CREATE TABLE `bump_houses` ( -- LIST-TABLE
  `company_id`          INT UNSIGNED NOT NULL PRIMARY KEY
, UNIQUE  KEY (`company_id`)
, FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("bump_houses", NULL,         "qualified bump houses")
, ("bump_houses", "company_id", "primary key, references the `companies` table")
;


CREATE TABLE `test_houses` ( -- LIST-TABLE
  `company_id`          INT UNSIGNED NOT NULL PRIMARY KEY
, `sftp_account`        VARCHAR(32)
, `tweak_program`       VARCHAR(255)
, UNIQUE  KEY (`company_id`)
, FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("test_houses", NULL,            "qualified test houses")
, ("test_houses", "company_id",    "primary key, references the `companies` table")
, ("test_houses", "sftp_account",  "account name for the SFTP dropbox")
, ("test_houses", "tweak_program", "program name that tweak this Test House's TPs")
;


CREATE TABLE `assembly_houses` ( -- LIST-TABLE
  `company_id`          INT UNSIGNED NOT NULL PRIMARY KEY
, UNIQUE  KEY (`company_id`)
, FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("assembly_houses", NULL,         "qualified assembly facilities")
, ("assembly_houses", "company_id", "primary key, references the `companies` table")
;


CREATE TABLE `foundries` ( -- LIST-TABLE
  `company_id`          INT UNSIGNED NOT NULL PRIMARY KEY
, `abbr`                VARCHAR(4)
, UNIQUE  KEY (`company_id`)
, FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("foundries", NULL,         "qualified foundries")
, ("foundries", "company_id", "primary key, references the `companies` table")
, ("foundries", "abbr",       "Abbreviation for the Foundry (aka: Fab)")
;


CREATE TABLE `ate_vendors` ( -- LIST-TABLE
  `company_id`          INT UNSIGNED NOT NULL PRIMARY KEY
, UNIQUE  KEY (`company_id`)
, FOREIGN KEY (`company_id`) REFERENCES `companies` (`company_id`)
);

INSERT INTO dbdoc(`table_name`, `field_name`, `description`) VALUES
  ("ate_vendors", NULL,         "automated test equipment vendors")
, ("ate_vendors", "company_id", "primary key, references the `companies` table")
;


################################################################################
