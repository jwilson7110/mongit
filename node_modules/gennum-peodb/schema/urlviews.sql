################################################################################
#
#  Page views
#

CREATE TABLE `urls` (
  `url_id`              INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `host`                VARCHAR(255) NOT NULL
, `url`                 VARCHAR(255) NOT NULL
, `method`              VARCHAR(16)  NOT NULL -- HEAD, GET, POST, SOCKET, etc...
, INDEX (`url`)
, UNIQUE KEY (`host`, `url`, `method`)
);

CREATE TABLE `url_agents` (
  `url_agent_id`        INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `user_agent`          VARCHAR(255) NOT NULL
, UNIQUE KEY (`user_agent`)
);

CREATE TABLE `url_views` (
  `url_view_id`         INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY
, `url_id`              INT UNSIGNED NOT NULL
, `url_agent_id`        INT UNSIGNED NOT NULL
, `user_id`             INT SIGNED   NOT NULL -- only log user actions
, `access_time`         DOUBLE       NOT NULL -- TIME_T
, `leave_time`          DOUBLE                -- TIME_T
, `post_data`           TEXT
, `client_ip`           TEXT
, FOREIGN KEY (`user_id`)      REFERENCES `users`      (`user_id`)
, FOREIGN KEY (`url_id`)       REFERENCES `urls`       (`url_id`)
, FOREIGN KEY (`url_agent_id`) REFERENCES `url_agents` (`url_agent_id`)
);

################################################################################


