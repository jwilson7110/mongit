#!/usr/bin/env node

//============================================================================//

require('colors');

require('console.log');

var async = require('async');

var print   = console.log;
var sprintf = require('printf');
var printf  = function() { print(sprintf.apply(null, arguments)); }

var peodb = require('gennum-peodb').setDefault(require('../../../peodb.conf'));

//============================================================================//

var key = 'anyRandomString';

//============================================================================//

function delEntries(cb) {
  print('delEntries');
  peodb.sharedDB.queryData('DELETE FROM plan_generic_entries', cb);
}

//============================================================================//

function addEntries(cb) {
  print('addEntries');

  var types = [ 'BUDGET', 'PLAN', 'ACTUAL' ];
  var years = [ 2010, 2011, 2012 ];
  var weeks = [ 34, 35, 36 ];

  var args = {
    user_id: -2,
    item_name: 'plan-generic',
  }
  var typeNum = 0;
  async.forEachSeries(types, function(type, cb) {
    typeNum++;
    async.forEachSeries(years, function(year, cb) {
      async.forEachSeries(weeks, function(week, cb) {
        args.entry_type = type;
        args.year  = year;
        args.week  = week;
        args.value = ((year - 2000)  * 100) + week + (typeNum * 0.1);
        peodb.addGenericPlanningEntry(args, cb);
      }, cb);
    }, cb);
  }, cb);
}

//============================================================================//

function getEntries(cb) {
  print('getEntries');
  peodb.getGenericPlanningEntries('plan-generic', function(err, data) {
    if (err) {
      return cb(err);
    }
    print(data);
    return cb();
  });
}

//============================================================================//
  
function main(cb) {
  async.series([
//    delEntries,   NOTE - disable to check the "active" functionality
    addEntries,
    getEntries
  ],
  function(err, data) {
    return cb(err);
  })
}

//============================================================================//

main(function(err, data) {
  peodb.end();
  if (err) {
    print(err.toString().bold.red);
  }
  else if (data) {
    print(data);
  }
})

//============================================================================//
